{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "proposal.schema.json",
  "title": "Change Proposal",
  "description": "Schema for change proposals generated by PROPOSE tools",
  "type": "object",
  "required": ["proposal_id", "plan_id", "task_id", "type", "created_at", "files", "status"],
  "properties": {
    "proposal_id": {
      "type": "string",
      "pattern": "^PROPOSAL-[A-Z0-9-]+$",
      "description": "Unique proposal identifier"
    },
    "plan_id": {
      "type": "string",
      "description": "Reference to originating plan"
    },
    "task_id": {
      "type": "string",
      "description": "Reference to task that generated this proposal"
    },
    "type": {
      "type": "string",
      "enum": ["patch", "create", "delete", "rename"],
      "description": "Type of change being proposed"
    },
    "created_at": {
      "type": "string",
      "format": "date-time"
    },
    "status": {
      "type": "string",
      "enum": ["pending", "approved", "rejected", "applied", "rolled_back"],
      "description": "Current proposal status"
    },
    "title": {
      "type": "string",
      "description": "Human-readable title"
    },
    "description": {
      "type": "string",
      "description": "Detailed description of the change"
    },
    "rationale": {
      "type": "string",
      "description": "Why this change is needed"
    },
    "risk_classification": {
      "type": "string",
      "enum": ["low", "medium", "high", "critical"],
      "description": "Risk level of the proposed change"
    },
    "files": {
      "type": "array",
      "description": "Files affected by this proposal",
      "items": {
        "type": "object",
        "required": ["path", "action"],
        "properties": {
          "path": {
            "type": "string",
            "description": "Relative path from project root"
          },
          "action": {
            "type": "string",
            "enum": ["modify", "create", "delete", "rename"]
          },
          "before_hash": {
            "type": "string",
            "description": "SHA256 hash of file before change (if exists)"
          },
          "after_hash": {
            "type": "string",
            "description": "SHA256 hash of file after change (in patch)"
          }
        }
      }
    },
    "patch_file": {
      "type": "string",
      "description": "Path to unified diff patch file"
    },
    "tests_to_run": {
      "type": "array",
      "description": "Tests that should be run after applying",
      "items": {
        "type": "string"
      }
    },
    "evidence_ids": {
      "type": "array",
      "description": "Evidence that supports this proposal",
      "items": {
        "type": "string"
      }
    },
    "request_hash": {
      "type": "string",
      "description": "SHA256 hash of proposal content for approval verification"
    }
  }
}
